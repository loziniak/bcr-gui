<app-header
  [title]="version.appName"
  [actionButtons]="actionButtons"
  [showCustomContent]="isMultiselect"
  [actionButtons]="actionButtons"
>
  <!-- custom toolbar content (multiselect) -->
  <ng-container *ngIf="isMultiselect">

    <!-- stop multiselection -->
    <ion-buttons slot="start">
      <ion-button (click)="clearSelection()">
        <ion-icon icon="close" slot="icon-only" />
      </ion-button>
    </ion-buttons>

    <!-- action buttons -->
    <ion-buttons slot="end">
        <ion-button (click)="deleteItems(getSelectedItems())" >
          <ion-icon icon="trash" slot="icon-only" />
        </ion-button>
    </ion-buttons>

  </ng-container>

  <!-- filter -->

    <!-- search -->
    <ion-toolbar *ngIf="isFilterPanelVisible" additionalToolbars>

      <div class="filter-container">

        <ion-searchbar
          show-clear-button="always"
          search-icon="search-circle"
          placeholder="Filter by name or number"
          [value]="filter.search"
          [debounce]="500"
          (ionInput)="onSearchChanged($event)"
        />

        <!-- tags filter -->
        <div class="flex gap-10" (click)="tags.showSelector()">
          <ion-icon class="icon" src="assets/icons/tag.svg" />
          <app-tags #tags [(selectedTags)]="filter.tags" (selectedTagsChange)="updateFilterStatus()"/>
        </div>

        <!-- clear button -->
        <div class="right-container">
          <ion-button class="clear-button" fill="clear" (click)="clearFilter()">Clear</ion-button>
        </div>

      </div>

    </ion-toolbar>

</app-header>


<!-- main list -->
<ion-content id="main-content" class="ion-padding" [class.disabled]="recordingsService.refreshProgress | async">

  <!-- <pre>
    {{ recordingsService.tags.value | json }}
  </pre> -->

  <!-- pull down the list to refresh content -->
  <ion-refresher slot="fixed"
    pullFactor=".5"
    pullMin="60"
    pullMax="120"
    (ionRefresh)="refreshList($any($event))"
  >
    <ion-refresher-content
      pullingIcon="refresh"
      apullingText="Pull to refresh"
      refreshingSpinner="circles"
      refreshingText="Refreshing..."
    >
  </ion-refresher-content>  </ion-refresher>

  <!-- recordings list -->
  <ion-list class="items" lines="full">

    <!-- recording list item -->
    <ion-card *ngFor="let item of recordingsService.recordings | async | recordingsSortFilter:settings.recordingsSortMode:filter"
      class="item"
      [class.selected]="item.selected"
      (click)="onItemClick(item)"
      longPress
      (longPress)="startMultiselection(item)"
    >
      <!-- multiselect checkbox -->
      <div>
        <ion-checkbox *ngIf="isMultiselect" class="checkbox" [(ngModel)]="item.selected" />
      </div>

      <div>
        <!-- card content -->
        <ion-card-header>
          <ion-card-title class="title">
            {{ item.opName }}
            <app-call-icon class="call-direction-icon" [direction]="item?.direction ?? ''" />
          </ion-card-title>
          <ion-card-subtitle class="left-right-container subtitle">
            <div>{{ item?.date | intlDate:settings.dateTimeStyle }}</div>
            <div *ngIf="item.duration">{{ item.duration | toHms }}</div>
          </ion-card-subtitle>
        </ion-card-header>

        <ion-card-content *ngIf="!isMultiselect && item.selected" class="content">

          <!-- details -->
          <div class="details">
            <p *ngIf="item.opName !== item.opNumber">Number: {{ item.opNumber }}</p>
            <p>Type: {{ item.mimeType }}</p>
            <p>Size: {{ item.filesize | filesize }}</p>
            <p *ngIf="!item.hasMetadata"><i>Missing .json metadata file!</i></p>
          </div>

          <!-- audio player -->
          <app-audio-player #audioPlayer class="player" [recording]="item" />

          <!-- action buttons -->
          <div class="icon-buttons-container align-end">

            <!-- edit -->
            <!-- <ion-icon name="pencil"
              class="icon-button"
              [class.disabled]="true"
              (click)="onActionNotImplemented(item)"
            /> -->

            <!-- share -->
            <ion-icon name="share-social"
              class="icon-button"
              (click)="shareRecording(item)"
            />

            <!-- delete -->
            <ion-icon name="trash"
              class="icon-button"
              (click)="deleteItems([item], audioPlayer)"
            />

          </div>

        </ion-card-content>

      </div>

    </ion-card>

  </ion-list>

</ion-content>
